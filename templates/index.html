{% extends "base.html" %}
{% block title %}Inicio{% endblock %}
{% block content %}
<h1>Productos</h1>
<div class="row">
{% for p in products %}
  <div class="col-md-3 mb-4">
    <div class="card h-100">
      {% if p.image_filename %}
        <img src="{{ url_for('static', filename='uploads/' ~ p.image_filename) }}" class="card-img-top" style="height:200px;object-fit:cover;">
      {% endif %}
      <div class="card-body">
        <h5 class="card-title">{{ p.title }}</h5>
        <p class="card-text">{{ p.description[:80] }}{% if p.description|length>80 %}...{% endif %}</p>
        <p class="fw-bold">${{ '%.2f'|format(p.price_cents/100) }}</p>
        <a href="{{ url_for('product_view', slug=p.slug) }}" class="btn btn-sm btn-primary">Ver</a>
        {% if current_user.is_authenticated and (current_user.id == p.user_id or current_user.is_admin) %}
          <a href="{{ url_for('edit_product', product_id=p.id) }}" class="btn btn-sm btn-secondary">Editar</a>
          <form method="post" action="{{ url_for('delete_product', product_id=p.id) }}" style="display:inline;">
            <button class="btn btn-sm btn-danger" onclick="return confirm('Eliminar producto?')">Eliminar</button>
          </form>
        {% endif %}
        <form method="post" action="{{ url_for('cart_add', product_id=p.id) }}" style="display:inline;">
          <button class="btn btn-sm btn-success">Agregar al carrito</button>
        </form>
      </div>
    </div>
  </div>
{% endfor %}
</div>
{% endblock %}
